#!/usr/bin/env perl
use strict;
use warnings;
use FindBin;
use lib "$FindBin::Bin/../local/lib/perl5";
use lib "$FindBin::Bin/../lib";
use Consts;
use DBI;
use Cwd;
use Getopt::Long;
use Pod::Usage;
use 5.38.0;

sub server {
    my ( $port, $msg ) = @_;
}

sub db {
    my ($dbfile) = @_;
    $dbfile =~ s~^:~./:~;
    my $db = DBI->connect("dbi:SQLite:dbname=$dbfile") or die $DBI::errstr;
}

sub main {

    # CLI args
    my $dbpath  = getcwd . "/corolla.sqlite3";
    my $help    = 0;
    my $man     = 0;
    my $version = 0;
    GetOptions(
        'db=s'   => \$dbpath,
        'help|?' => \$help,
        'man'    => \$man,
        'V'      => \$version
    ) or pod2usage( -exitval => 1, -verbose => 1 );
    pod2usage( -exitval => 0, -verbose => 1 ) if $help;
    pod2usage( -exitval => 0, -verbose => 2 ) if $man;

    if ($version) {
        say "corolla v" . Consts::VERSION;
    }
    else {
        # main execution
        db $dbpath;
    }
}

main

__END__

=head1 NAME

main

=head1 SYNOPSIS

corolla [options] -db corolla.sqlite3 

=head1 OPTIONS

=over 8

=item B<-help>

Helps you.

=item B<-man>

The manual.

=item B<-db>

Filepath to SQLite database. Default: ./corolla.sqlite3

=back

=head1 DESCRIPTION

Starts a corolla DB.

=cut
